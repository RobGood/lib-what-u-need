{
   "README" : "This is the endpoint for the upload form.",
   "_dateCreated" : "Mon Apr  1 12:56:01 2013",
   "_useCount" : 66,
   "api-entry-points" : "{\n  GET/         usage\n  GET/~args*   usage\n  POST/        upload\n  POST/~args*  upload\n}",
   "api-handlers" : {
      "upload" : "(= info (mime-parse (hash-get $req-info / request-content)))\n(= data (hash-clear $info / data))\n\n(= input-name   (hash-get $info /Content-Disposition name))\n(= filename     (hash-get $info /Content-Disposition filename))\n(= content-type (hash-get $info /headers Content-Type))\n\n(= path (join / $req-args))\n(if (ne '' $path) (= path \"${path}/\"))\n\n(= filename (urlencode (utf8-encode $filename)))\n\n(= var-name-data (sprintf <%s%s>      $path $filename))\n(= var-name-ct   (sprintf <%s%s.type> $path $filename $content-type))\n\n(= $var-name-data $data)\n(= $var-name-ct   $content-type)\n\n(= msg \"uploaded file saved to var $var-name-data\")\n(= download-url \"http://${host}/api/dplx/${path}${filename}\")\n\n(reply-json $[msg var-name-data var-name-ct download-url info req-args])",
      "usage" : "(= input-name uploader)\n(= path (join / $req-args))\n\n# access: $<\"$path/$file-name\">\n\n(reply-html (html-app-template\n  (html-utility-heading $app-title)\n\n  (html-form-upload\n    \"/api/dplx/upload/$path\"\n    'Choose a file to upload: '\n    $input-name)\n))"
   },
   "main" : "(fn ())",
   "on-load" : "(fn ()\n  (desc-read _ HTML-macros)\n  (desc-read _ top-page)\n\n  (= app-title 'Upload a file')\n)",
   "rcs-id" : "$Id: upload,v 1.57 2013/04/18 05:38:58 apache Exp apache $",
   "request-from-client" : {
      "schema" : {
         "HTTP" : {
            "GET" : {
               ".on-match." : "(hash-eval $self /api-handlers usage)",
               "~args*" : {
                  ".on-match." : "(hash-eval $self /api-handlers usage)"
               }
            },
            "POST" : {
               ".on-match." : "(hash-eval $self /api-handlers upload)",
               "~args*" : {
                  ".on-match." : "(hash-eval $self /api-handlers upload)"
               }
            }
         }
      }
   }
}
